package fr.grenoble.polytech.ricm.itest;

import fr.grenoble.polytech.ricm.entity.Categorie;
import fr.grenoble.polytech.ricm.iface.ICatalogueEjbRemote;

import java.util.Properties;
import javax.naming.Context;
import javax.naming.InitialContext;
import org.junit.After;
import org.junit.Before;
import org.junit.Test;
import static org.junit.Assert.*;

public class EjbIntegrationTest {

    private Properties env;
    private Context ctx;

    public EjbIntegrationTest() {
        env = new Properties();
        env.setProperty( "java.naming.factory.initial", "com.sun.enterprise.naming.impl.SerialInitContextFactory" );
        env.setProperty( "java.naming.factory.state", "com.sun.corba.ee.impl.presentation.rmi.JNDIStateFactoryImpl" );
        env.setProperty( "java.naming.factory.url.pkgs", "com.sun.enterprise.naming" );
        env.setProperty( "org.omg.CORBA.ORBInitialHost", "localhost" );
        env.setProperty( "org.omg.CORBA.ORBInitialPort", "3700" );
        env.setProperty( Context.PROVIDER_URL, "iiop://127.0.0.1:3700" );
    }

    @Before
    public void setUp() throws Exception {
        ctx = new InitialContext(env);
	//ctx = new InitialContext( env );
    }

    @After
    public void tearDown() throws Exception {
        ICatalogueEjbRemote catalogue = ( ICatalogueEjbRemote ) ctx.lookup( ICatalogueEjbRemote.JNDI_NAME );
        catalogue.cleanupTables();
    }

    @Test
    public void testBMPProcessCommit() throws Exception {
        Categorie categorie1 = new Categorie();
        categorie1.setDesignation( "contents1" );        

        ICatalogueEjbRemote catalogue = ( ICatalogueEjbRemote ) ctx.lookup( ICatalogueEjbRemote.JNDI_NAME );
        catalogue.executeBMPProcess(categorie1);

	categorie1 = catalogue.findCategorieByDesignation( "contents1" );
        assertEquals( "contents1", categorie1.getDesignation() );
        
    }    
}
